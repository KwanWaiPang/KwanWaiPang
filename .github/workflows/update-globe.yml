name: Update Globe Widget svg
on:
  schedule:
    - cron: "0 */24 * * *"   # 每24小时运行一次，可根据需要调整频率
  workflow_dispatch: # 允许手动触发

  # run on every push on the master branch
  push:
    branches:
    - main #每次有push这个分支的时候都触发

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 允许写入仓库

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install Puppeteer
        run: npm install puppeteer

      - name: Generate Globe Widget SVG
        run: |
          # 假设你已经在仓库根目录中准备好了 generate-globe.js 脚本和 globe.html 文件
          node generate-globe.js
        # 该脚本应将生成的 SVG 输出到 dist 文件夹，例如：dist/globe-widget.svg

      - name: Push generated SVG to output branch
        uses: crazy-max/ghaction-github-pages@v2.5.0
        with:
          target_branch: output    # 目标分支
          build_dir: dist            # 存放生成文件的目录
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}  # 你需要在仓库设置中添加该 PAT
